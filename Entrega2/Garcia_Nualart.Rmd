---
title: Número de pasajeros en el Puerto de Barcelona (2012-2019)
author:
- Garcia Sató, Pol
- Nualart Sanz, Arnau
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
    code_folding: hide
    theme: united
    highlight: tango
  word_document:
    toc: yes
  pdf_document:
    fig_caption: yes
    number_sections: yes
    toc_depth: 2
subtitle: Segona pràctica Anàlisi de Series Temporals
header-includes:
- \pagenumbering{gobble}
- \usepackage{subfig}
- \usepackage[labelsep=period]{caption}
- \usepackage[labelfont=bf]{caption}
- \renewcommand{\and}{\\}
---

```{=tex}
\renewcommand{\contentsname}{Índex}
\renewcommand{\figurename}{Figura}
\renewcommand{\tablename}{Taula}
```
\captionsetup{width=.75\textwidth}

\vspace{120mm}

<left> 
![](C:/Users/polgs/Desktop/Grau estadística UB/4rt de carrera/1er Quadrimestre/AnalisisSeriesTemporals/Entrega2/Imatges/ub.png){width="50%"}

</left> <right> 
![](C:/Users/polgs/Desktop/Grau estadística UB/4rt de carrera/1er Quadrimestre/AnalisisSeriesTemporals/Entrega2/Imatges/upc.png){width="50%"}
</right>

\newpage

```{=tex}
\begin{center}
El objetivo de este informe es ver el comportamiento del número de pasajeros en el puerto de Barcelona durante los años 2012 - 2019 y hacer una predicción para el período 2020 - 2022 si no se tuvieran en cuenta los efectos causados por la pandemia del SARS-CoV-2. 

Se observa que los datos presentan tendencia creciente y estacionalidad multiplicativa. Es decir, con el paso de los años la demanda fue aumentando. Además, hay un claro patrón estacional que muestra que en los meses de verano el número es superior a los meses de otoño e invierno. 

En cuanto a la predicción, la demanda sigue aumentando de manera multiplicativa y siguiendo el mismo patrón estacional. 
\end{center}
```
 
\pagebreak

\tableofcontents

\pagebreak

# Introducció

## Descripción del entorno y el problema - motivación del trabajo

Desde el estallido de la pandemia del SARS-CoV-2 las preferencias de la población respecto a sus destinos vacacionales parecen haber cambiado. Actualmente, los viajeros están más interesados en lugares naturales, al aire libre, debido a que en la época del confinamiento mucha parte de la población se sintió agobiada dentro de sus hogares. Adicionalmente, los españoles se han centrado en un turismo nacional debido a la situación de crisis sanitaria que estamos viviendo. Así pues, el número de pasajeros en el Puerto de Barcelona puede haber disminuido drásticamente ya que los cruceros son espacios cerrados y suelen ser vacaciones internacionales.

El objetivo principal de este informe es ver cuál era el comportamiento del número de pasajeros en el Puerto de Barcelona, ya sean de cruceros como de ferris, en los años anteriores a la pandemia. De esta manera se podrá ver de manera correcta la tendencia creciente que se tenía antes de la crisis sin tener en cuenta la posible caída debida a la pandemia.

Para la elección de los años analizados, se ha evitado estudiar aquellos momentos temporales en los que había un factor condicionante. Por tanto, los datos tomados dejan fuera la crisis económica del 2008 y la pandemia del 2020. También tendremos en cuenta que a principios del 2012 hubo el desastre de la naviera italiana Costa Concordia con 32 muertos, lo cual hizo que hubiera un descenso significativo en el número de pasajeros en los cruceros del Mediterráneo. Teniendo esto en cuenta, solo se han seleccionado los datos mensuales pertenecientes al espacio temporal comprendido entre 2012 y 2019, ambos períodos incluidos.

\medskip

## Definición precisa de la variable

La variable a estudiar es el número de pasajeros que llegan al Puerto de Barcelona durante el periodo ya comentado anteriormente. Cabe destacar que esta variable recoge tanto el número de llegadas internas (nacionales) como externas (internacionales).

## Descripción de la fuente de información

Los datos han sido extraídos de los casos propuestos del repositorio que precisamos en el CV de la UB. Provienen de la web del Ministerio del Fomento (http://www.fomento.gob.es) en el apartado Ministerio de Fomento / Marítimo / Información Estadística y corresponden al número de pasajeros que llegan al Puerto de Barcelona.

## Resumen de la estructura del trabajo 

El estudio sigue el siguiente esquema:

- _Aplicación empírica_

En este apartado se observan cuáles son las características principales de la serie (media, varianza, tendencia, estacionalidad, residuos,. . . ). Es decir, se analiza descriptivamente la serie para así tener un conocimiento previo de los datos.

- _Metodología de alisado_

A partir del análisis realizado en el apartado anterior se decide qué tipo de serie se ajusta mejor a nuestros datos. A partir de aquí, se hace una predicción para observar cuál sería el número de viajeros en alojamientos rurales en los próximos años si no existiera ningún factor condicionante que actuará como brecha, en el caso expuesto, si no existiera la pandemia del Covid-19. 

\medskip

# Aplicación empírica
## Análisis descriptivo de la serie

El análisis descriptivo de los datos seleccionados comenzará con una herramienta visual, un gráfico que permitirá observar la distribución de éstos a lo largo de los 8 años estudiados. 
El gráfico temporal tiene la siguiente forma:

```{r setup, include = FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

```{r echo = FALSE, fig.align = 'center', fig.dim=c(7, 4)}
serie=window(ts(read.table("pasajebcn.dat"),start=1997,freq=12),start=2009)

plot(serie, main = "Ocupacion en alojamientos de turismo rural en España")
abline(v = 2009:2019, col = 4, lty = 3)
```

Como ya se explicó con detalle en la práctica 1, la serie estudiada presenta una tendencia creciente y una estacionalidad multiplicativa de orden s = 12. 

## Identificación del modelo
### Transformación de la serie temporal en una serie estacionaria

Para que la serie estudiada sea estacionaria estudiaremos que la varianza sea constante, que no exista componente estacional y que presente una media constante.

**Varianza constante**

Se dispone de dos soportes gráficos que permiten ver si la varianza de la serie es constante o no: *Gráfico medias vs varianzas* y *Boxplot por periodos*. 

```{r echo = FALSE, fig.align='center', fig.dim = c(7, 2.9)}
par(mfrow=c(1,2))

m = apply(matrix(serie,ncol=12),2,mean)
v = apply(matrix(serie,ncol=12),2,var)
plot(v~m,main="Mean-Variance plot")

boxplot(serie~floor(time(serie)), main = "Boxplot")
```

En el primer gráfico podemos observar que, a medida que aumenta la media,  también lo hace la varianza. Lo mismo podemos decir en el segundo gráfico boxplot, donde el rango intercuartílico aumenta al mismo paso que aumenta el nivel de la serie.

Entonces podemos concluir que la varianza de la serie no es constante. Para que lo sea, usaremos una transformación logarítmica graficando de nuevo los datos.

```{r echo = FALSE, fig.dim = c(5.5, 3), fig.align='center'}
lnserie=log(serie)
plot(lnserie,type="o")
```

Ahora sí podríamos decir que la varianza de la serie se ha estabilizado al aplicar la transformación logaritmica. 

\medskip

**Patrón estacional**

Para saber si existe patrón estacional usaremos la función `monthplot`, que calcula la media en cada orden estacional. En nuestro caso, mensualmente.

```{r echo = FALSE, fig.align='center', fig.dim = c(5.5, 3)}
monthplot(lnserie)
```

Vemos claramente que hay irregularidades en la media para cada mes, ya que no hay equilibrio en sus líneas horizonales. Por lo que podemos decir que la serie presenta un patrón estacional de orden s=12, como se ha dicho anteriormente. Para poder eliminarlo, se realiza una diferenciación estacional (D = 1), es decir, se restan las observaciones del patrón estacional anterior. Por tanto, se eliminarán S = 12 observaciones, las 12 primeras. 

```{r echo = FALSE}
d12lnserie<-diff(lnserie,lag=12)
```

Volvemos a utilizar la función `monthplot` sobre la serie diferenciada estacionalmente para comprobar que se haya eliminado el patrón estacional.

```{r echo = FALSE, fig.dim = c(5.5, 2.7), fig.align='center'}
monthplot(d12lnserie)
```

Vemos que, efectivamente, se han estabilizado las medias de cada mes, por lo que podemos afirmar que hemos eliminado el patrón estacional.

\medskip

**Media constante**

Se obtiene el gráfico temporal de la serie en escala logarítmica y con una diferenciación estacional. 

```{r echo = FALSE, fig.align='center', fig.dim = c(5.5, 2.7)}
plot(d12lnserie,main="d12lnserie")
abline(h=0)
abline(h=mean(d12lnserie), col=2)
```

La media de la serie si parece constante pero se observa que la media no toma el valor 0. Por acuerdo académico no se trabajará con medias distintas a 0. Así pues, para cumplir el acuerdo, se hace una diferenciación regular (d = 1). Para verificar que la media de la serie toma el valor 0 se vuelve a graficar la serie temporal una vez aplicada dicha diferenciación. 

```{r echo = FALSE}
d1d12lnserie <- diff(d12lnserie)
```



```{r echo = FALSE, fig.align='center', fig.dim = c(5.5, 2.7)}
plot(d1d12lnserie,main="d1d12lnserie")
abline(h=0)
abline(h=mean(d1d12lnserie), col=2)
```
La media de la serie ahora si toma el valor 0. Para assegurar que la serie no presenta sobrediferenciación se comparan las varianzas. La mejor serie será aquella que tenga una menor varianza. 

```{r echo = FALSE}
v1 <- var(lnserie)
v2 <- var(d12lnserie)
v3 <- var(d1d12lnserie)
```

| Modelo   | lnserie | d12lnserie | d1d12lnserie |
|----------|---------|------------|--------------|
| Varianza | `r v1`  | `r v2`     | `r v3`       |

Se observa que la serie con menor varianza es aquella que presenta escala logarítmica y una diferenciación estacional. Por tanto, significa que la diferenciación regular no es necesaria. Aún así, ésta se mantendrá por el motivo expuesto anteriormente, para conseguir que la media tome el valor 0. 

>

### Identificación de modelos pausibles

Para identificar algunos modelos se grafican el ACF y el PACF de la serie estacionaria. 

Cabe destacar que primeramente se seleccionarán los modelos más parsimoniosos. Si en el apartado de *validación* no se valida ninguno de ellos, se volverá al presente apartado para proponer otros modelos más complejos. 

Para una mejor identificación, en el siguiente gráfico se muestra en color rojo los "s" rezagos estacionales de la función (P)ACF. En negro, todos los rezagos regulares. 

```{r echo = FALSE, fig.align='center', fig.dim = c(7, 3)}
par(mfrow=c(1,2))

acf(d1d12lnserie,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,11)),lwd=2)
pacf(d1d12lnserie,ylim=c(-1,1),lag.max=60,col=c(rep(1,11), 2),lwd=2)
```

Antes de la proposición de modelos, cabe especificar que se confirma que se ha llegado a la serie estacionaria ya que los valores de la ACF decaen de manera rápida hacia el 0. 

\medskip

